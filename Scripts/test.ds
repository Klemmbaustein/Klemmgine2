using engine
using engine::input

module game

class MyObject : SceneObject
{
	[Export]
	AssetRef testModel = emptyAsset("kmdl")

	MoveComponent movement = new MoveComponent()
	CameraComponent camera = new CameraComponent()

	override async fn begin()
	{
		const testMesh = new MeshComponent()
		testMesh.load(testModel)
		attach(testMesh)

		attach(camera)
		attach(movement)
		camera.use()
		camera.setFOV(80)

		int i = 0

		while i < 10
		{
			info($"{i}")
			await wait(0.25)
			i += 1
		}
	}

	override fn update()
	{
		if isKeyDown(Key::w)
		{
			movement.addInput(forward(rotation))
		}
		if isKeyDown(Key::s)
		{
			movement.addInput(-forward(rotation))
		}
		if isKeyDown(Key::d)
		{
			movement.addInput(right(rotation))
		}
		if isKeyDown(Key::a)
		{
			movement.addInput(-right(rotation))
		}

		const mouseMovement = getMouseMovement()

		rotation.y -= mouseMovement.x
		rotation.p -= mouseMovement.y
	}

	override fn destroy()
	{
		fn() -> float x = testing
		info($"{x.call()}")

		int[] array = [1, 2, 3]

		for const i = array {
			info($"{i}")
		}
	}
}

fn testing() -> float
{
	return 25
}
