using engine
using engine::input

module game

class MyObject : SceneObject
{
	[Export]
	AssetRef testModel = emptyAsset("kmdl")

	MoveComponent movement = new()
	CameraComponent camera = new()

	async fn addOneAsync(int value) -> int
	{
		await wait(1.0)
		return 1 + value
	}

	override fn begin()
	{
		const testMesh = new MeshComponent()
		testMesh.load(testModel)
		attach(testMesh)

		attach(camera)
		attach(movement)
		camera.use()
		camera.setFOV(80)
	}

	override fn update()
	{
		Rotation3 moveRotation = rot3(0, this.rotation.y, 0)
	
		if isKeyDown(Key::w)
		{
			movement.addInput(forward(moveRotation))
		}
		if isKeyDown(Key::s)
		{
			movement.addInput(-forward(moveRotation))
		}
		if isKeyDown(Key::d)
		{
			movement.addInput(right(moveRotation))
		}
		if isKeyDown(Key::a)
		{
			movement.addInput(-right(moveRotation))
		}
		
		if isKeyDown(Key::e)
		{
			movement.jump()
		}

		Vector2 mouseMovement = getMouseMovement()

		rotation.y -= mouseMovement.x
		rotation.p -= mouseMovement.y
	}

	override fn destroy()
	{
	}
}
