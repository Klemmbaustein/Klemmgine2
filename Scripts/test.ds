using engine
using engine::input

module game

class MyObject : SceneObject
{
	[Export]
	AssetRef testModel = emptyAsset("kmdl")

	MoveComponent movement = new()
	CameraComponent camera = new()

	override fn begin()
	{
		const testMesh = new MeshComponent()
		testMesh.load(testModel)
		attach(testMesh)

		attach(camera)
		attach(movement)
		camera.use()
		camera.setFOV(80)
		camera.position = new(0, 1, 0)
		const _ = doStuffAsync()
	}

	async fn doStuffAsync()
	{
		await wait(1)
		info("hello!")
		task t = system::async::sleep()
		
		await t
		info("hello!")
	}

	override fn update()
	{
		Rotation3 moveRotation = new(0, this.rotation.y, 0)
		
		if isKeyDown(Key::w)
		{
			movement.addInput(forward(moveRotation))
		}
		if isKeyDown(Key::s)
		{
			movement.addInput(-forward(moveRotation))
		}
		if isKeyDown(Key::d)
		{
			movement.addInput(right(moveRotation))
		}
		if isKeyDown(Key::a)
		{
			movement.addInput(-right(moveRotation))
		}

		if isKeyDown(Key::space)
		{
			movement.jump()
		}

		Vector2 mouseMovement = getMouseMovement()

		rotation.y -= mouseMovement.x
		camera.rotation.p -= mouseMovement.y
	}

	override fn destroy()
	{
	}
}
