using engine
using engine::input

module game

class MyObject : SceneObject
{
	[Export]
	AssetRef testModel = emptyAsset("kmdl")

	MoveComponent movement = new()
	CameraComponent camera = new()

	override fn begin()
	{
		MeshComponent testMesh = new()
		testMesh.load(testModel)
		attach(testMesh)
		testMesh.scale = new(0.5, 1, 0.5)

		attach(camera)
		attach(movement)
		camera.use()
		camera.setFOV(80)
		camera.position = new(0, 0.8, 0)

		woah a = parser()

		a.hi()
	}

	override fn update()
	{
		Rotation3 moveRotation = new(0, this.rotation.y, 0)

		if isKeyDown(Key::w)
		{
			movement.addInput(forward(moveRotation))
		}
		if isKeyDown(Key::s)
		{
			movement.addInput(-forward(moveRotation))
		}
		if isKeyDown(Key::d)
		{
			movement.addInput(right(moveRotation))
		}
		if isKeyDown(Key::a)
		{
			movement.addInput(-right(moveRotation))
		}

		if isKeyDown(Key::space)
		{
			movement.jump()
		}

		Vector2 mouseMovement = getMouseMovement()

		rotation.y -= mouseMovement.x
		camera.rotation.p -= mouseMovement.y

		if camera.rotation.p < -90 {
			camera.rotation.p = -90
		}

		if camera.rotation.p > 90 {
			camera.rotation.p = 90
		}
	}

	override fn destroy()
	{
	}
}

class woah
{
	string message = ""

	fn new(string message)
	{
		this.message = message
	}

	fn hi()
	{
		info(message)
	}
}

fn parser() -> woah
{
	return new woah("hello")
}